/*! videojs-chromecast - v0.0.1 - 2014-09-16
* https://github.com/kim-company/videojs-chromecast
* Copyright (c) 2014 KIM Keep In Mind GmbH, srl; Licensed MIT */

(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};vjs.plugin("chromecast",function(a){return this.player=this,this.chromecastComponent=new vjs.ChromecastComponent(this,a),this.player.controlBar.addChild(this.chromecastComponent)}),vjs.ChromecastComponent=function(a){function c(a,b){this.settings=b,vjs.Button.call(this,a,b),a.controls()||this.disable(),this.hide(),this.el_.setAttribute("role","button"),this.initializeApi()}return b(c,a),c.prototype.kind_="chromecast",c.prototype.buttonText="Chromecast",c.prototype.className="vjs-chromecast-button ",c.prototype.apiInitialized=!1,c.prototype.apiSession=null,c.prototype.apiMedia=null,c.prototype.casting=!1,c.prototype.paused=!0,c.prototype.muted=!1,c.prototype.currentVolume=1,c.prototype.currentMediaTime=0,c.prototype.timer=null,c.prototype.timerStep=1e3,c.prototype.initializeApi=function(){var a,b;if(vjs.IS_CHROME)return chrome.cast&&chrome.cast.isAvailable?(b=new chrome.cast.SessionRequest(this.settings.appId?this.settings.appId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID),a=new chrome.cast.ApiConfig(b,this.sessionJoinedListener,this.receiverListener.bind(this)),chrome.cast.initialize(a,this.onInitSuccess.bind(this),this.castError)):void setTimeout(this.initializeApi.bind(this),1e3)},c.prototype.sessionJoinedListener=function(a){return vjs.log("Joined "+a.sessionId)},c.prototype.receiverListener=function(a){return"available"===a?this.show():void 0},c.prototype.onInitSuccess=function(){return this.apiInitialized=!0},c.prototype.castError=function(a){return vjs.log("Cast Error: "+JSON.stringify(a))},c.prototype.doLaunch=function(){return this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError):vjs.log("Session not initialized")},c.prototype.onSessionSuccess=function(a){var b,c;return this.apiSession=a,this.addClass("connected"),c=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),"video/mp4"),b=new chrome.cast.media.LoadRequest(c),b.autoplay=!0,b.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(b,this.onMediaDiscovered.bind(this),this.castError)},c.prototype.onMediaDiscovered=function(a){return this.apiMedia=a,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.paused=!1,this.player_.loadTech("ChromecastTech",{}),this.player_.userActive(!0),this.casting=!0},c.prototype.onMediaStatusUpdate=function(){return this.apiMedia?(this.currentMediaTime=this.apiMedia.currentTime,"IDLE"===this.apiMedia.playerState?(this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess()):void 0):void 0},c.prototype.startProgressTimer=function(a){return this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(a.bind(this),this.timerStep)},c.prototype.play=function(){return this.apiMedia&&this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.onError),this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.paused=!1):void 0},c.prototype.pause=function(){return this.apiMedia?this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.onError),this.paused=!0):void 0},c.prototype.seekMedia=function(a){var b;return b=new chrome.cast.media.SeekRequest,b.currentTime=a,this.apiMedia.seek(b,this.onSeekSuccess.bind(this,a),this.onError)},c.prototype.onSeekSuccess=function(a){return this.currentMediaTime=a},c.prototype.setMediaVolume=function(a,b){var c,d;if(this.apiMedia)return d=new chrome.cast.Volume,d.level=a,d.muted=b,this.currentVolume=d.level,this.muted=b,c=new chrome.cast.media.VolumeRequest,c.volume=d,this.apiMedia.setVolume(c,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.onError),this.player_.trigger("volumechange")},c.prototype.incrementMediaTime=function(){return this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING?this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer)):void 0},c.prototype.mediaCommandSuccessCallback=function(a){return vjs.log(a)},c.prototype.onError=function(){return vjs.log("error")},c.prototype.stopCasting=function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)},c.prototype.onStopAppSuccess=function(){return clearInterval(this.timer),this.casting=!1,this.removeClass("connected"),this.player_.src(this.player_.options_.sources),vjs.insertFirst(this.player_.tech.el_,this.player_.el()),"IDLE"===this.apiMedia.playerState?(this.player_.currentTime(0),this.player_.onPause()):(this.player_.currentTime(this.currentMediaTime),this.paused||this.player_.play()),this.apiMedia=null},c.prototype.buildCSSClass=function(){return this.className+vjs.Button.prototype.buildCSSClass.call(this)},c.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div")},c.prototype.onClick=function(){return vjs.Button.prototype.onClick.call(this),this.casting?this.stopCasting():this.doLaunch()},c}(vjs.Button),vjs.ChromecastTech=function(a){function c(a,b,c){this.features.volumeControl=!0,this.features.movingMediaElementInDOM=!1,this.features.fullscreenResize=!1,this.features.progressEvents=!0,this.features.timeupdateEvents=!0,vjs.MediaTechController.call(this,a,b,c),this.el_=videojs.Component.prototype.createEl("div",{id:"myId",className:"vjs-tech",innerHTML:'<img src="'+this.player_.options_.poster+'" class="backgroundImage"/><div class="currentlyCasting"><h2 class="castingLabel">Casting to device</h2></div>'}),vjs.insertFirst(this.el_,this.player_.el()),this.triggerReady()}return b(c,a),c.prototype.defaultMuted=!1,c.prototype.loop=!1,c.isSupported=function(){return this.player_.chromecastComponent.apiInitialized},c.canPlaySource=function(a){return"video/mp4"===a.type},c.prototype.dispose=function(){return vjs.MediaTechController.prototype.dispose.call(this)},c.prototype.play=function(){return this.player_.chromecastComponent.play(),this.player_.onPlay()},c.prototype.pause=function(){return this.player_.chromecastComponent.pause(),this.player_.onPause()},c.prototype.paused=function(){return this.player_.chromecastComponent.paused},c.prototype.currentTime=function(){return this.player_.chromecastComponent.currentMediaTime},c.prototype.setCurrentTime=function(a){return this.player_.chromecastComponent.seekMedia(a)},c.prototype.duration=function(){return 0},c.prototype.buffered=function(){return{length:0}},c.prototype.volume=function(){return this.player_.chromecastComponent.currentVolume},c.prototype.setVolume=function(a){return this.player_.chromecastComponent.setMediaVolume(a,!1)},c.prototype.muted=function(){return this.player_.chromecastComponent.muted},c.prototype.setMuted=function(a){return this.player_.chromecastComponent.setMediaVolume(this.player_.chromecastComponent.currentVolume,a)},c.prototype.supportsFullScreen=function(){return!1},c.prototype.enterFullScreen=function(){return vjs.log("enterFullScreen")},c.prototype.exitFullScreen=function(){return vjs.log("exitFullScreen")},c.prototype.src=function(a){return vjs.log("ChromecastTech::src -> "+a)},c.prototype.load=function(){return vjs.log("ChromecastTech::load")},c.prototype.currentSrc=function(){return vjs.log("currentSrc")},c.prototype.poster=function(){return vjs.log("poster?")},c.prototype.setPoster=function(a){return vjs.log("setPoster: "+a)},c.prototype.preload=function(){return!0},c.prototype.setPreload=function(a){return vjs.log("setPreload: "+a)},c.prototype.autoplay=function(){return!0},c.prototype.setAutoplay=function(a){return vjs.log("setAutoplay: "+a)},c.prototype.controls=function(){return!0},c.prototype.setControls=function(a){return vjs.log("setControls: "+a)},c.prototype.setLoop=function(a){return vjs.log("setLoop: "+a)},c.prototype.error=function(){return!1},c.prototype.seeking=function(){return!1},c.prototype.ended=function(){return!1},c}(vjs.MediaTechController)}).call(this);